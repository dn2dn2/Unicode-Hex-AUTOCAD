<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoLISP Translator</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f4f6f8; 
            margin: 0; padding: 40px 20px; 
            display: flex; justify-content: center;
        }

        .container {
            width: 100%; max-width: 900px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: border-top-color 0.3s;
            border-top: 6px solid #3498db; 
        }

        .header { text-align: center; padding: 25px 0 10px; }
        h1 { margin: 0; color: #2c3e50; font-size: 24px; text-transform: uppercase; letter-spacing: 1px; }

        .control-panel {
            background-color: #f8f9fa; padding: 20px; border-bottom: 1px solid #eee;
            display: flex; flex-direction: column; align-items: center; gap: 15px;
        }

        .mode-switch {
            display: flex; background: #e9ecef; border-radius: 30px; padding: 4px;
        }
        .mode-switch label {
            padding: 10px 25px; cursor: pointer; font-weight: bold; color: #6c757d;
            transition: all 0.3s; border-radius: 30px;
        }
        .tab-active-blue { background-color: #3498db; color: white !important; }
        .tab-active-green { background-color: #27ae60; color: white !important; }

        .sub-options { display: flex; gap: 20px; font-size: 14px; }
        .sub-options label { cursor: pointer; display: flex; align-items: center; gap: 5px; color: #555; }
        .hidden { display: none !important; }

        .io-area { padding: 30px; display: grid; gap: 20px; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #34495e; }
        
        textarea {
            width: 100%; height: 200px; padding: 15px;
            border: 2px solid #e9ecef; border-radius: 8px;
            font-family: 'Courier New', monospace; font-size: 15px;
            box-sizing: border-box; resize: vertical;
        }
        textarea:focus { outline: none; border-color: #3498db; }
        .result-box { background-color: #f8f9fa; color: #333; font-weight: bold; }

        .btn-copy {
            width: 100%; padding: 15px; border: none; border-radius: 8px;
            font-size: 16px; font-weight: bold; color: white; cursor: pointer;
            transition: background 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        
        .theme-blue textarea:focus { border-color: #3498db; }
        .theme-blue .btn-copy { background-color: #3498db; }
        .theme-blue .btn-copy:hover { background-color: #2980b9; }

        .theme-green textarea:focus { border-color: #27ae60; }
        .theme-green .btn-copy { background-color: #27ae60; }
        .theme-green .btn-copy:hover { background-color: #219150; }
    </style>
</head>
<body class="theme-blue">

<div class="container" id="mainContainer">
    <div class="header">
        <h1>B·ªô chuy·ªÉn ƒë·ªïi AutoLISP</h1>
    </div>

    <div class="control-panel">
        <div class="mode-switch">
            <label id="tabEncode" class="tab-active-blue" onclick="switchDirection('encode')">
                Ti·∫øng Vi·ªát ‚ûî AutoLISP
            </label>
            <label id="tabDecode" onclick="switchDirection('decode')">
                AutoLISP ‚ûî Ti·∫øng Vi·ªát
            </label>
        </div>

        <div class="sub-options" id="subOptions">
            <label><input type="radio" name="codeType" value="code" checked onchange="process()"> Nguy√™n Code (Code Block)</label>
            <label><input type="radio" name="codeType" value="text" onchange="process()"> VƒÉn b·∫£n th∆∞·ªùng (Raw Text)</label>
        </div>
    </div>

    <div class="io-area">
        <div class="input-group">
            <label id="lblInput">Nh·∫≠p n·ªôi dung Ti·∫øng Vi·ªát:</label>
            <textarea id="inputText" placeholder="V√≠ d·ª•: (alert &quot;Xin ch√†o&quot;)..." oninput="process()"></textarea>
        </div>

        <div class="input-group">
            <label id="lblOutput">K·∫øt qu·∫£ M√£ Lisp:</label>
            <textarea id="outputText" class="result-box" readonly></textarea>
        </div>

        <button class="btn-copy" onclick="copyResult()">üìã Sao ch√©p k·∫øt qu·∫£</button>
    </div>
</div>

<script>
    let currentMode = 'encode';

    function switchDirection(mode) {
        currentMode = mode;
        const container = document.getElementById('mainContainer');
        const body = document.body;
        const subOpts = document.getElementById('subOptions');
        
        const tabEncode = document.getElementById('tabEncode');
        const tabDecode = document.getElementById('tabDecode');
        const lblInput = document.getElementById('lblInput');
        const lblOutput = document.getElementById('lblOutput');
        const txtInput = document.getElementById('inputText');
        const txtOutput = document.getElementById('outputText');

        txtInput.value = ""; txtOutput.value = "";

        if (mode === 'encode') {
            container.style.borderTopColor = "#3498db";
            body.className = "theme-blue";
            tabEncode.className = "tab-active-blue";
            tabDecode.className = "";
            subOpts.classList.remove('hidden');
            lblInput.innerText = "Nh·∫≠p n·ªôi dung Ti·∫øng Vi·ªát:";
            lblOutput.innerText = "K·∫øt qu·∫£ M√£ Lisp:";
            txtInput.placeholder = 'V√≠ d·ª•: (alert "Xin ch√†o")...';
        } else {
            container.style.borderTopColor = "#27ae60";
            body.className = "theme-green";
            tabEncode.className = "";
            tabDecode.className = "tab-active-green";
            subOpts.classList.add('hidden');
            lblInput.innerText = "D√°n M√£ Lisp (\\U+xxxx):";
            lblOutput.innerText = "N·ªôi dung Ti·∫øng Vi·ªát:";
            txtInput.placeholder = 'V√≠ d·ª•: ??? - B\\\\U+1EA3ng t√™n l\\\\U+1EC7nh...';
        }
    }

    function process() {
        if (currentMode === 'encode') runEncode();
        else runDecode();
    }

    function runEncode() {
        const input = document.getElementById('inputText').value;
        const type = document.querySelector('input[name="codeType"]:checked').value;
        let output = "";

        for (let i = 0; i < input.length; i++) {
            let charCode = input.charCodeAt(i);
            let char = input[i];

            if (type === "text") {
                if (char === '"') output += '\\"';
                else if (char === '\\') output += '\\\\';
                else if (charCode > 127) output += "\\U+" + charCode.toString(16).toUpperCase().padStart(4, '0');
                else output += char;
            } else {
                if (charCode > 127) output += "\\U+" + charCode.toString(16).toUpperCase().padStart(4, '0');
                else output += char;
            }
        }
        document.getElementById('outputText').value = output;
    }

    // --- H√ÄM GI·∫¢I M√É ƒê√É ƒê∆Ø·ª¢C N√ÇNG C·∫§P (FIX L·ªñI) ---
    function runDecode() {
        let input = document.getElementById('inputText').value;
        
        // B∆Ø·ªöC 1: X·ª≠ l√Ω d·∫•u g·∫°ch ch√©o k√©p (\\) th√†nh ƒë∆°n (\) TR∆Ø·ªöC
        // ƒê·ªÉ bi·∫øn 'B\\U+...' th√†nh 'B\U+...' gi√∫p regex b√™n d∆∞·ªõi b·∫Øt ƒë√∫ng
        let output = input.replace(/\\\\/g, '\\');

        // B∆Ø·ªöC 2: Sau ƒë√≥ m·ªõi d·ªãch m√£ Unicode
        output = output.replace(/\\U\+([0-9A-Fa-f]{4})/gi, (match, hexGroup) => {
            return String.fromCharCode(parseInt(hexGroup, 16));
        });

        // B∆Ø·ªöC 3: X·ª≠ l√Ω n·ªët d·∫•u ngo·∫∑c k√©p tho√°t (\")
        output = output.replace(/\\"/g, '"');
        
        document.getElementById('outputText').value = output;
    }

    function copyResult() {
        const copyText = document.getElementById("outputText");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        if (navigator.clipboard) {
            navigator.clipboard.writeText(copyText.value).then(() => alert("ƒê√£ sao ch√©p!")).catch(err => console.error(err));
        } else {
            document.execCommand("copy");
            alert("ƒê√£ sao ch√©p!");
        }
    }
</script>

</body>
</html>
